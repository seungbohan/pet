<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="naver-site-verification" content="878c81293bdfaf1f57c9394918d51e5100b6899e" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÎèôÎ∞òÍ∞ÄÎä• Ïû•ÏÜå</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=ufwzhw6j2z"></script>
    <script src="/js/MarkerClustering.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script th:src="@{/js/starrr.js}"></script>
    <script src="/js/map/review.js"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        position: relative;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        overflow: hidden;
    }

    /* Îç∞Ïä§ÌÅ¨ÌÉë Ïä§ÌÉÄÏùº (Í∏∞Ï°¥ ÏΩîÎìú Ïú†ÏßÄ) */
    @media (min-width: 769px) {
        /* ÏôºÏ™Ω ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î */
        .left-navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 60px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e0e0e0;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .nav-logo span {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .nav-logo img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }

        .nav-item {
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .nav-item:hover {
            background-color: #f5f5f5;
        }

        .nav-item.active {
            background-color: #e3f2fd;
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            fill: #555;
        }

        .nav-item.active svg {
            fill: #1976d2;
        }

        .nav-item span {
            font-size: 10px;
            color: #555;
            margin-top: 2px;
            text-align: center;
        }

        .nav-item.active span {
            color: #1976d2;
        }

        /* Î™©Î°ù ÌÜ†Í∏Ä Î≤ÑÌäº */
        .list-toggle {
            position: absolute;
            top: 50%;
            right: -15px;
            transform: translateY(-50%);
            width: 30px;
            height: 60px;
            background: white;
            border: 1px solid #e0e0e0;
            border-left: none;
            border-radius: 0 15px 15px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 2999;
        }

        .list-toggle:hover {
            background-color: #f5f5f5;
        }

        .list-toggle svg {
            width: 16px;
            height: 16px;
            fill: #555;
            transition: transform 0.3s ease;
        }

        .list-toggle.active svg {
            transform: rotate(180deg);
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î Ïä§ÌÉÄÏùº */
        .sidebar {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-right: 1px solid #e9ecef;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }

        .sidebar.open {
            left: 60px;
        }

        .sidebar-header {
            padding: 20px 24px;
            background: #007bff;
            color: white;
            position: relative;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .sidebar-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin: 4px 0 0 0;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .filter-section {
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
            background: white;
        }

        .filter-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 12px;
        }

        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .category-filter {
            padding: 6px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .category-filter:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .category-filter.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
        }

        .sort-options {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .sort-btn {
            padding: 4px 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sort-btn:hover {
            background: #e9ecef;
        }

        .sort-btn.active {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }

        .places-list {
            padding: 0;
        }

        .place-item {
            padding: 16px 24px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .place-item:hover {
            background-color: #f8f9fa;
        }

        .place-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #007bff;
        }

        .place-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .place-title {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            margin: 0;
            line-height: 1.4;
        }

        .category-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            margin-left: 8px;
        }

        .place-address {
            font-size: 14px;
            color: #6c757d;
            margin: 4px 0;
            line-height: 1.4;
        }

        .place-distance {
            font-size: 12px;
            color: #28a745;
            margin-top: 8px;
            font-weight: 500;
        }

        .place-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            padding: 6px 12px;
            background: none;
            border: 1px solid #dee2e6;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
            color: #007bff;
        }

        /* ÏßÄÎèÑ Ï°∞Ï†ï */
        .map-container {
            margin-left: 60px;
            transition: margin-left 0.3s ease;
        }

        .map-container.sidebar-open {
            margin-left: 460px;
        }

        /* ÌòÑÏû¨ÏúÑÏπò Î≤ÑÌäº */
        .location-btn {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .location-btn:hover {
            background-color: #f8f9fa;
            border-color: #007bff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
        }

        /* ÏÉÅÏÑ∏Ï†ïÎ≥¥ Ìå®ÎÑê */
        .detail-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e9ecef;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 2500;
            display: flex;
            flex-direction: column;
        }

        .detail-panel.open {
            left: 460px;
        }

        .detail-header {
            padding: 20px 24px;
            background: #28a745;
            color: white;
            position: relative;
        }

        .detail-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
            padding-right: 40px;
        }

        .detail-category {
            font-size: 14px;
            opacity: 0.9;
            margin: 4px 0 0 0;
        }

        .detail-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .detail-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-info {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .detail-info-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-info-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .detail-info-label {
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            width: 80px;
            flex-shrink: 0;
        }

        .detail-info-value {
            font-size: 14px;
            color: #212529;
            flex: 1;
            line-height: 1.4;
        }

        .detail-distance {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .detail-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .detail-action-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .detail-action-btn.primary {
            background: #007bff;
            color: white;
        }

        .detail-action-btn.primary:hover {
            background: #0056b3;
        }

        .detail-action-btn.secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .detail-action-btn.secondary:hover {
            background: #e9ecef;
        }

        /* ÏßÄÎèÑ Ï°∞Ï†ï */
        .map-container.detail-open {
            margin-left: 860px;
        }

        .map-container.sidebar-open:not(.detail-open) {
            margin-left: 460px;
        }

        /* ÏÇ¨Ïö©Ïûê ÏúÑÏπò Ï†ïÎ≥¥ */
        .user-location-info {
            background: #e3f2fd;
            padding: 12px 24px;
            border-bottom: 1px solid #e9ecef;
            font-size: 12px;
            color: #1565c0;
        }

        /* Î™®Î∞îÏùºÏóêÏÑú Ïà®ÍπÄ */
        .mobile-only {
            display: none;
        }
    }

    /* Î™®Î∞îÏùº Ïä§ÌÉÄÏùº */
    @media (max-width: 768px) {
        body {
            height: 100vh;
            background: #f5f5f5;
        }

        /* Îç∞Ïä§ÌÅ¨ÌÉë ÏöîÏÜå Ïà®Í∏∞Í∏∞ */
        .left-navbar,
        .sidebar,
        .list-toggle {
            display: none !important;
        }

        /* ÏÉÅÎã® Ìó§Îçî */
        .floating-logo {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .floating-logo img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .header-title {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        /* ÏßÄÎèÑ Ïª®ÌÖåÏù¥ÎÑà - Ï†ÑÏ≤¥ ÌôîÎ©¥ */
        .map-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            margin-left: 0 !important;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* ÌòÑÏû¨ÏúÑÏπò Î≤ÑÌäº */
        .location-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .location-btn:active {
            transform: scale(0.95);
        }

        /* ÌïòÎã® Ìå®ÎÑê */
        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            z-index: 2000;
            transition: transform 0.3s ease;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            max-height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
        }

        .bottom-panel.collapsed {
            transform: translateY(calc(100% - 120px));
        }

        /* Ìå®ÎÑê Ìó§Îçî (ÎìúÎûòÍ∑∏ Ìï∏Îì§) */
        .panel-header {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            position: relative;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }

        .panel-handle {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 0 auto 15px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .panel-subtitle {
            font-size: 14px;
            color: #666;
        }

        /* Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ */
        .category-section {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .category-filters {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .category-filters::-webkit-scrollbar {
            display: none;
        }

        .category-filter {
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: fit-content;
        }

        .category-filter.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
            transform: scale(1.05);
        }

        .category-filter:active {
            transform: scale(0.95);
        }

        /* Ï†ïÎ†¨ ÏòµÏÖò */
        .sort-section {
            padding: 0 20px 20px;
            flex-shrink: 0;
        }

        .sort-options {
            display: flex;
            gap: 10px;
        }

        .sort-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
        }

        .sort-btn.active {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sort-btn:active {
            transform: scale(0.95);
        }

        /* Ïû•ÏÜå Î™©Î°ù */
        .places-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .places-list {
            padding: 0;
        }

        .place-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .place-item:active {
            background-color: #f8f9fa;
        }

        .place-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #007bff;
        }

        .place-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .place-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            line-height: 1.4;
            flex: 1;
            margin-right: 10px;
        }

        .category-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
        }

        .place-address {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .place-distance {
            font-size: 13px;
            color: #28a745;
            font-weight: 600;
        }

        .place-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
        }

        .action-btn:active {
            transform: scale(0.95);
            background: #f8f9fa;
        }

        /* ÏÉÅÏÑ∏ Ìå®ÎÑê (ÌíÄÏä§ÌÅ¨Î¶∞) */
        .detail-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 3000;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .detail-panel.open {
            transform: translateY(0);
        }

        .detail-header {
            padding: 20px;
            background: #28a745;
            color: white;
            position: relative;
            padding-top: calc(env(safe-area-inset-top) + 20px);
        }

        .detail-back-btn {
            position: absolute;
            left: 20px;
            top: calc(env(safe-area-inset-top) + 20px);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-back-btn:active {
            transform: scale(0.95);
        }

        .detail-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0 50px 5px 0;
            line-height: 1.3;
        }

        .detail-category {
            font-size: 14px;
            opacity: 0.9;
        }

        .detail-close-btn {
            display: none;
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .detail-distance {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        .detail-section {
            margin: 0;
        }

        .detail-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            padding: 20px 20px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-info {
            padding: 0 20px 20px;
            background: transparent;
        }

        .detail-info-item {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: flex-start;
        }

        .detail-info-item:last-child {
            border-bottom: none;
        }

        .detail-info-label {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            width: 80px;
            flex-shrink: 0;
        }

        .detail-info-value {
            font-size: 14px;
            color: #333;
            flex: 1;
            line-height: 1.4;
        }

        /* Ïï°ÏÖò Î≤ÑÌäºÎì§ */
        .detail-actions {
            padding: 20px;
            display: flex;
            gap: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .detail-action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .detail-action-btn.primary {
            background: #007bff;
            color: white;
        }

        .detail-action-btn.secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .detail-action-btn:active {
            transform: scale(0.95);
        }

        /* Îç∞Ïä§ÌÅ¨ÌÉë Ï†ÑÏö© ÏöîÏÜå Ïà®ÍπÄ */
        .desktop-only {
            display: none;
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î Í¥ÄÎ†® ÌÅ¥ÎûòÏä§ Ï†úÍ±∞ */
        .map-container.sidebar-open,
        .map-container.detail-open {
            margin-left: 0 !important;
        }
    }

    /* Í≥µÌÜµ Ïä§ÌÉÄÏùº */
    /* Ïù¥ÎØ∏ÏßÄ Ïä¨ÎùºÏù¥Îçî CSS */
    .image-slider {
        margin-bottom: 24px;
    }

    .slider-container {
        position: relative;
        width: 100%;
        height: 200px;
        overflow: hidden;
        border-radius: 8px;
        background: #f8f9fa;
    }

    .edit-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    }

    .edit-modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .edit-modal-content h3 {
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 20px;
        font-weight: 600;
        color: #212529;
    }

    .edit-form label {
        display: block;
        margin-top: 15px;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 14px;
        color: #495057;
    }

    .edit-form .input-counter {
        text-align: right;
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
    }

    @media (max-width: 768px) {
        .edit-form .input-counter {
            color: #666;
        }
    }

    .edit-rating-section {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        text-align: center;
        margin-bottom: 15px;
    }

    #editRatingInput {
        font-size: 28px;
    }

    #editRatingInput a {
        font-size: 28px;
        margin-right: 4px;
    }

    #edit-content {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        resize: vertical;
        min-height: 100px;
        transition: border-color 0.2s ease;
    }

    #edit-content:focus {
        outline: none;
        border-color: #007bff;
    }

    .edit-buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .edit-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    #save-edit {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }

    #save-edit:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    #cancel-edit {
        background: #f8f9fa;
        color: #495057;
        border: 1px solid #dee2e6;
    }

    #cancel-edit:hover {
        background: #e9ecef;
    }

    /* Î™®Î∞îÏùº ÎåÄÏùë */
    @media (max-width: 768px) {
        .edit-modal-content {
            width: 95%;
            padding: 25px 20px;
        }

        #editRatingInput a {
            font-size: 32px;
            margin-right: 5px;
        }

        #edit-content {
            font-size: 16px;
        }

        .edit-buttons button {
            flex: 1;
            padding: 15px;
        }
    }

    @media (max-width: 768px) {
        .slider-container {
            height: 250px;
        }
    }

    .slider-wrapper {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.3s ease;
    }

    .image-box {
        flex: 0 0 100%;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }

    .slider-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: background-color 0.2s ease;
    }

    @media (max-width: 768px) {
        .slider-nav {
            width: 45px;
            height: 45px;
            font-size: 20px;
        }

        .slider-nav:active {
            transform: translateY(-50%) scale(0.9);
        }

        .slider-prev { left: 15px; }
        .slider-next { right: 15px; }
    }

    .slider-nav:hover {
        background: rgba(0, 0, 0, 0.7);
    }

    .slider-prev {
        left: 10px;
    }

    .slider-next {
        right: 10px;
    }

    .image-counter {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
    }

    @media (max-width: 768px) {
        .image-counter {
            bottom: 15px;
            right: 15px;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 13px;
        }
    }

    .slider-dots {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 6px;
    }

    @media (max-width: 768px) {
        .slider-dots {
            bottom: 15px;
            gap: 8px;
        }
    }

    .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    @media (max-width: 768px) {
        .dot {
            width: 10px;
            height: 10px;
        }
    }

    .dot.active {
        background: white;
    }

    .review-content {
        font-size: 14px;
        color: #333;
        line-height: 1.6;
        margin-bottom: 8px;
        word-wrap: break-word;
        word-break: break-word;
        overflow-wrap: break-word;
        white-space: pre-wrap;
    }

    .review-content.collapsible {
        max-height: 80px;
        overflow: hidden;
        position: relative;
    }

    .review-content.expanded {
        max-height: none;
    }

    .review-toggle {
        color: #007bff;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        display: inline-block;
        margin-bottom: 12px;
    }

    .review-toggle:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .review-content {
            font-size: 15px;
            line-height: 1.7;
        }

        .review-toggle {
            font-size: 14px;
            margin-bottom: 15px;
        }
    }

    /* Î¶¨Î∑∞ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
    .review-section {
        margin-bottom: 24px;
    }

    @media (max-width: 768px) {
        .review-section {
            border-top: 8px solid #f8f9fa;
            margin-bottom: 0;
        }
    }

    .review-summary {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 16px;
        text-align: center;
    }

    @media (max-width: 768px) {
        .review-summary {
            padding: 20px;
            margin: 0;
            border-radius: 0;
        }
    }

    .review-average {
        font-size: 32px;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 8px;
    }

    @media (max-width: 768px) {
        .review-average {
            font-size: 36px;
        }
    }

    .review-count {
        font-size: 14px;
        color: #6c757d;
        margin-bottom: 12px;
    }

    @media (max-width: 768px) {
        .review-count {
            color: #666;
            margin-bottom: 15px;
        }
    }

    .review-summary .starrr {
        margin: 0 auto 16px;
    }

    /* Î¶¨Î∑∞ ÏûëÏÑ± Ìèº Í∞úÏÑ† */
    .review-form {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    @media (max-width: 768px) {
        .review-form {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            border-radius: 0;
            border: none;
            box-shadow: none;
            margin-bottom: 0;
        }
    }

    .review-form h4 {
        margin: 0 0 20px 0;
        font-size: 18px;
        font-weight: 600;
        color: #212529;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    @media (max-width: 768px) {
        .review-form h4 {
            color: #333;
        }
    }

    .review-form h4::before {
        content: "‚úçÔ∏è";
        font-size: 20px;
    }

    .review-input-group {
        margin-bottom: 20px;
    }

    .review-input-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    @media (max-width: 768px) {
        .review-input-label {
            font-weight: 500;
            color: #333;
            margin-bottom: 10px;
        }
    }

    .review-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s ease;
        background: white;
        resize: none;
    }

    @media (max-width: 768px) {
        .review-input {
            padding: 15px;
            border-radius: 15px;
            font-size: 16px;
            min-height: 120px;
        }
    }

    .review-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        transform: translateY(-1px);
    }

    @media (max-width: 768px) {
        .review-input:focus {
            transform: none;
        }
    }

    .review-textarea {
        min-height: 100px;
        max-height: 200px;
        line-height: 1.6;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .review-submit-btn {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 16px;
    }

    @media (max-width: 768px) {
        .review-submit-btn {
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            width: 100%;
            justify-content: center;
            margin-top: 15px;
        }

        .review-submit-btn:active {
            transform: scale(0.98);
        }
    }

    .review-submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 123, 255, 0.3);
    }

    @media (max-width: 768px) {
        .review-submit-btn:hover {
            transform: none;
        }
    }

    .review-submit-btn:active {
        transform: translateY(0);
    }

    /* Î≥ÑÏ†ê ÏÑπÏÖò Ïä§ÌÉÄÏùºÎßÅ */
    .rating-section {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        text-align: center;
    }

    @media (max-width: 768px) {
        .rating-section {
            padding: 20px;
            border-radius: 15px;
        }
    }

    #ratingInput {
        font-size: 32px;
        margin: 8px 0;
        letter-spacing: 4px;
    }

    @media (max-width: 768px) {
        #ratingInput {
            font-size: 30px;
            margin: 10px 0;
        }
    }

    /* ÏûÖÎ†•Ïπ∏ Í∞úÏàò ÌëúÏãú */
    .input-counter {
        text-align: right;
        font-size: 12px;
        color: #6c757d;
        margin-top: 4px;
    }

    @media (max-width: 768px) {
        .input-counter {
            color: #666;
            margin-top: 5px;
        }
    }

    /* Î¶¨Î∑∞ Î™©Î°ù Ïä§ÌÉÄÏùºÎèÑ Í∞úÏÑ† */
    .review-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: all 0.2s ease;
    }

    @media (max-width: 768px) {
        .review-item {
            border: none;
            border-radius: 0;
            box-shadow: none;
            border-bottom: 1px solid #f0f0f0;
            margin-bottom: 0;
        }
    }

    .review-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
        .review-item:hover {
            transform: none;
            box-shadow: none;
        }
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #f1f3f4;
    }

    @media (max-width: 768px) {
        .review-header {
            border-bottom: 1px solid #f0f0f0;
        }
    }

    .review-author {
        font-weight: 600;
        color: #212529;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    @media (max-width: 768px) {
        .review-author {
            color: #333;
        }
    }

    .review-author::before {
        content: "üë§";
        font-size: 14px;
        opacity: 0.7;
    }

    .review-date {
        font-size: 12px;
        color: #6c757d;
        background: #f8f9fa;
        padding: 4px 8px;
        border-radius: 12px;
    }

    @media (max-width: 768px) {
        .review-date {
            color: #666;
        }
    }

    /* Starrr.js Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
    .starrr, .starrr-readonly {
        display: inline-block;
    }

    .starrr a, .starrr-readonly a {
        font-size: 16px;
        text-decoration: none;
        color: #ccc;
        cursor: pointer;
        display: inline-block;
        line-height: 1;
    }

    .starrr a.btn-rating-hover,
    .starrr a.btn-rating-selected,
    .starrr-readonly a.btn-rating-hover,
    .starrr-readonly a.btn-rating-selected {
        color: #FFD700 !important;
    }

    .starrr a.fa-star,
    .starrr-readonly a.fa-star {
        color: #FFD700;
    }

    .starrr a.fa-star-o,
    .starrr-readonly a.fa-star-o {
        color: #ccc;
    }

    /* ÌÅ¨Í∏∞Î≥Ñ Ïä§ÌÉÄÏùº */
    #ratingInput.starrr a {
        font-size: 24px;
        margin-right: 4px;
    }

    @media (max-width: 768px) {
        #ratingInput.starrr a {
            font-size: 28px;
            margin-right: 5px;
        }
    }

    #averageStars.starrr a {
        font-size: 20px;
        margin-right: 2px;
    }

    .review-rating .starrr a {
        font-size: 16px;
        margin-right: 1px;
    }

    /* Safe area ÎåÄÏùë */
    @supports (padding: max(0px)) {
        @media (max-width: 768px) {
            .floating-logo {
                top: max(20px, env(safe-area-inset-top));
            }

            .location-btn {
                top: max(20px, env(safe-area-inset-top));
            }
        }
    }
</style>
<body>
<!-- Îç∞Ïä§ÌÅ¨ÌÉë Ï†ÑÏö©: ÏôºÏ™Ω ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
<div class="left-navbar desktop-only">
    <div class="nav-logo">
        <a th:href="@{/}"><img src="/images/KakaoTalk_20250908_145552894_01.png" alt="wihpet logo image"></a>
    </div>

    <div class="nav-menu">
        <div class="nav-item" id="mapBtn">
            <svg viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
            <span>ÏßÄÎèÑ Ï§å</span>
        </div>
    </div>

    <div class="nav-menu" style="margin-top: auto;">
    </div>

    <!-- Î™©Î°ù ÌÜ†Í∏Ä Î≤ÑÌäº -->
    <div class="list-toggle desktop-only" id="listToggle">
        <svg viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
        </svg>
    </div>
</div>

<!-- Î™®Î∞îÏùº Ï†ÑÏö©: ÏÉÅÎã® Ìó§Îçî -->
<div class="floating-logo mobile-only">
    <a th:href="@{/}"><img src="/images/KakaoTalk_20250908_145552894_01.png" alt="wihpet logo image"></a>
</div>

<!-- ÌòÑÏû¨ÏúÑÏπò Î≤ÑÌäº -->
<button class="location-btn" id="locationBtn" title="ÌòÑÏû¨ ÏúÑÏπòÎ°ú Ïù¥Îèô">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="#007bff">
        <path d="M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22S19,14.25 19,9A7,7 0 0,0 12,2M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5Z"/>
    </svg>
</button>

<!-- Îç∞Ïä§ÌÅ¨ÌÉë Ï†ÑÏö©: ÏÇ¨Ïù¥ÎìúÎ∞î -->
<div class="sidebar desktop-only" id="sidebar">
    <div class="sidebar-header">
        <h2 class="sidebar-title">Ïû•ÏÜå Î™©Î°ù</h2>
        <p class="sidebar-subtitle">Ï¥ù <span id="desktopPlaceCount">0</span>Í∞ú Ïû•ÏÜå</p>
        <button class="close-btn" id="closeSidebar">√ó</button>
    </div>

    <div class="sidebar-content">
        <div class="user-location-info" id="userLocationInfo">
            ÌòÑÏû¨ÏúÑÏπò Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨Îê©ÎãàÎã§
        </div>

        <div class="filter-section">
            <div class="filter-title">Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞</div>
            <div class="category-filters" id="desktopCategoryFilters">
                <div class="category-filter active" data-category="all">Ï†ÑÏ≤¥</div>
            </div>

            <div class="sort-options">
                <button class="sort-btn active" data-sort="distance">Í±∞Î¶¨Ïàú</button>
                <button class="sort-btn" data-sort="name">Ïù¥Î¶ÑÏàú</button>
            </div>
        </div>

        <div class="places-list" id="desktopPlacesList">
            <!-- Ïû•ÏÜå Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
    </div>
</div>

<!-- Î™®Î∞îÏùº Ï†ÑÏö©: ÌïòÎã® Ìå®ÎÑê -->
<div class="bottom-panel collapsed mobile-only" id="bottomPanel">
    <div class="panel-header" id="panelHeader">
        <div class="panel-handle"></div>
        <div class="panel-title">Ï£ºÎ≥Ä Ïû•ÏÜå</div>
        <div class="panel-subtitle">Ï¥ù <span id="mobilePlaceCount">0</span>Í∞ú Ïû•ÏÜå</div>
    </div>

    <div class="category-section">
        <div class="category-title">Ïπ¥ÌÖåÍ≥†Î¶¨</div>
        <div class="category-filters" id="mobileCategoryFilters">
            <div class="category-filter active" data-category="all">Ï†ÑÏ≤¥</div>
        </div>
    </div>

    <div class="sort-section">
        <div class="sort-options">
            <button class="sort-btn active" data-sort="distance">Í±∞Î¶¨Ïàú</button>
            <button class="sort-btn" data-sort="name">Ïù¥Î¶ÑÏàú</button>
        </div>
    </div>

    <div class="places-container" id="placesContainer">
        <div class="places-list" id="mobilePlacesList">
            <!-- Ïû•ÏÜå Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
    </div>
</div>

<!-- ÏßÄÎèÑ Ïª®ÌÖåÏù¥ÎÑà -->
<div class="map-container" id="mapContainer">
    <div id="map" style="width:100%;height:100vh;"></div>
</div>

<!-- ÏÉÅÏÑ∏Ï†ïÎ≥¥ Ìå®ÎÑê -->
<div class="detail-panel" id="detailPanel">
    <div class="detail-header">
        <!-- Î™®Î∞îÏùº Ï†ÑÏö© Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
        <button class="detail-back-btn mobile-only" id="detailBackBtn">‚Üê</button>
        <!-- Îç∞Ïä§ÌÅ¨ÌÉë Ï†ÑÏö© Îã´Í∏∞ Î≤ÑÌäº -->
        <button class="detail-close-btn desktop-only" id="closeDetailPanel">√ó</button>
        <h2 class="detail-title" id="detailTitle">Ïû•ÏÜåÎ™Ö</h2>
        <p class="detail-category" id="detailCategory">Ïπ¥ÌÖåÍ≥†Î¶¨</p>
    </div>

    <div class="detail-content">
        <div class="detail-distance" id="detailDistance">
            ÌòÑÏû¨ÏúÑÏπòÏóêÏÑú 1.2km
        </div>

        <div class="image-slider">
            <div class="slider-container">
                <div class="slider-wrapper sliderWrapper">
                    <!-- JavaScriptÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <button class="slider-nav slider-prev" onclick="prevSlide()">‚Äπ</button>
                <button class="slider-nav slider-next" onclick="nextSlide()">‚Ä∫</button>

                <div class="image-counter">
                    <span class="currentImageIndex">1</span> / <span>1</span>
                </div>

                <div class="slider-dots sliderDots">
                    <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
                </div>
            </div>
        </div>

        <div class="detail-section">
            <h3 class="detail-section-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                Í∏∞Î≥∏ Ï†ïÎ≥¥
            </h3>
            <div class="detail-info" id="detailBasicInfo">
                <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
            </div>
        </div>

        <!-- Î¶¨Î∑∞ ÏÑπÏÖò -->
        <div class="detail-section review-section">
            <h3 class="detail-section-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                Î¶¨Î∑∞ (<span id="reviewCount">0</span>)
            </h3>

            <!-- Î¶¨Î∑∞ ÏöîÏïΩ -->
            <div class="review-summary">
                <div class="review-average" id="reviewAverage">0.0</div>
                <div class="review-count" id="reviewCountText">Î¶¨Î∑∞ 0Í∞ú</div>
            </div>

            <!-- Î¶¨Î∑∞ ÏûëÏÑ± Ìèº -->
            <div class="review-form">
                <h4>Î¶¨Î∑∞ ÏûëÏÑ±ÌïòÍ∏∞</h4>

                <div class="review-input-group">
                    <label class="review-input-label">ÌèâÏ†êÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</label>
                    <div class="rating-section">
                        <div class="starrr" id="ratingInput" data-rating="0"></div>
                        <p style="font-size: 12px; color: #6c757d; margin: 8px 0 0 0;">Î≥ÑÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú ÌèâÏ†êÏùÑ Îß§Í≤®Ï£ºÏÑ∏Ïöî</p>
                    </div>
                </div>

                <div class="review-input-group">
                    <label class="review-input-label">ÎÇ¥Ïö©</label>
                    <div class="content-input-wrapper">
                        <textarea class="review-input review-textarea" id="reviewContent" placeholder="Ïù¥Í≥≥ÏóêÏÑúÏùò Í≤ΩÌóòÏùÑ Í≥µÏú†Ìï¥Ï£ºÏÑ∏Ïöî" maxlength="500"></textarea>
                    </div>
                    <div class="input-counter">
                        <span id="contentCount">0</span>/500
                    </div>
                </div>

                <button class="review-submit-btn" onclick="submitReview()">Îì±Î°ù</button>
            </div>

            <!-- Î¶¨Î∑∞ Î™©Î°ù -->
            <div class="review-list" id="reviewList">
                <!-- Î¶¨Î∑∞Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
            </div>

            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
            <div class="pagination" id="reviewPagination">
                <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖòÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
            </div>
        </div>

        <div class="detail-actions">
            <button class="detail-action-btn primary" id="focusOnMapBtn">ÏßÄÎèÑÏóêÏÑú Î≥¥Í∏∞</button>
            <button class="detail-action-btn secondary" id="getDirectionsBtn">Í∏∏Ï∞æÍ∏∞</button>
        </div>
    </div>
</div>

<script>
    let map;
    let allPlaces = [];
    let filteredPlaces = [];
    let currentCategory = 'all';
    let currentSort = 'distance';
    let markers = [];
    let markerClustering = null;
    let userLocation = null;
    let detailPanelOpen = false;
    let selectedPlace = null;
    let sidebarOpen = false;
    let panelExpanded = false;

    // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Î≥ÄÏàò (Î™®Î∞îÏùº Ï†ÑÏö©)
    let startY = 0;
    let currentY = 0;
    let isDragging = false;

    // ÌôîÎ©¥ ÌÅ¨Í∏∞ Í∞êÏßÄ
    function isMobile() {
        return window.innerWidth <= 768;
    }

    // Í±∞Î¶¨ Í≥ÑÏÇ∞ Ìï®ÏàòÎì§
    function calculateDistance(lat1, lng1, lat2, lng2) {
        const R = 6371;
        const dLat = deg2rad(lat2 - lat1);
        const dLng = deg2rad(lng2 - lng1);
        const a =
            Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = R * c;
        return distance;
    }

    function deg2rad(deg) {
        return deg * (Math.PI/180);
    }

    function formatDistance(distance) {
        if (distance < 1) {
            return `${Math.round(distance * 1000)}m`;
        } else {
            return `${distance.toFixed(1)}km`;
        }
    }

    // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
    function initMap(center) {
        userLocation = center;

        const zoomLevel = isMobile() ? 16 : 15;

        map = new naver.maps.Map('map', {
            center,
            zoom: zoomLevel,
            minZoom: 10,
            maxZoom: 19,
            mapDataControl: false,
            logoControlOptions: {
                position: naver.maps.Position.BOTTOM_LEFT
            }
        });

        // ÏÇ¨Ïö©Ïûê ÏúÑÏπò ÎßàÏª§
        const markerSize = isMobile() ? 24 : 20;
        new naver.maps.Marker({
            position: center,
            map: map,
            icon: {
                content: `<div style="
                    width: ${markerSize}px;
                    height: ${markerSize}px;
                    background: #007bff;
                    border: ${isMobile() ? 4 : 3}px solid white;
                    border-radius: 50%;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                "></div>`,
                anchor: new naver.maps.Point(markerSize/2, markerSize/2)
            },
            title: 'ÌòÑÏû¨ ÏúÑÏπò'
        });

        naver.maps.Event.once(map, 'init', getMap);
    }

    // ÏúÑÏπò Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                let lat = position.coords.latitude;
                let lng = position.coords.longitude;
                let currentLocation = new naver.maps.LatLng(lat, lng);
                initMap(currentLocation);
            },
            function(error) {
                console.log(error);
                let defaultLocation = new naver.maps.LatLng(37.566535, 126.977969);
                initMap(defaultLocation);
            }
        );
    } else {
        alert("ÏúÑÏπò Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.");
        let defaultLocation = new naver.maps.LatLng(37.566535, 126.977969);
        initMap(defaultLocation);
    }

    // Ïπ¥ÌÖåÍ≥†Î¶¨ Ïä§ÌÉÄÏùº Ìï®Ïàò
    function getCategoryStyle(contenttypeid) {
        const categoryStyles = {
            '12': {
                category: 'Í¥ÄÍ¥ëÏßÄ',
                color: '#FF6B6B',
                bgColor: '#FFE5E5'
            },
            '14': {
                category: 'Î¨∏ÌôîÏãúÏÑ§',
                color: '#4ECDC4',
                bgColor: '#E5F9F6'
            },
            '15': {
                category: 'ÌñâÏÇ¨',
                color: '#45B7D1',
                bgColor: '#E5F4FD'
            },
            '28': {
                category: 'Î†àÌè¨Ï∏†',
                color: '#96CEB4',
                bgColor: '#F0F9F4'
            },
            '32': {
                category: 'ÏàôÎ∞ï',
                color: '#FFC400',
                bgColor: '#FFFBEA'
            },
            '38': {
                category: 'ÏáºÌïë',
                color: '#DDA0DD',
                bgColor: '#F8F0F8'
            },
            '39': {
                category: 'ÏùåÏãùÏ†ê',
                color: '#FFA07A',
                bgColor: '#FFF2ED'
            }
        };

        return categoryStyles[contenttypeid] || {
            category: 'Í∏∞ÌÉÄ',
            color: '#6C757D',
            bgColor: '#F8F9FA'
        };
    }

    // ÎßàÏª§ HTML ÏÉùÏÑ±
    function createMarkerHtml(title, contenttypeid) {
        const style = getCategoryStyle(contenttypeid);
        const maxWidth = isMobile() ? 150 : 120;
        const height = isMobile() ? 45 : 40;
        const fontSize = isMobile() ? 13 : 12;

        if (isMobile()) {
            return `
                <div style="
                    position: relative;
                    padding: 8px 12px;
                    max-width: ${maxWidth}px;
                    height: ${height}px;
                    background-color: ${style.bgColor};
                    border: 2px solid ${style.color};
                    border-radius: 22px;
                    font-size: ${fontSize}px;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    box-shadow: 0 3px 12px rgba(0,0,0,0.2);
                    transition: all 0.2s ease;
                "
                title="${title} (${style.category})">
                    <span style="margin-right: 6px; font-size: 16px">${style.emoji}</span>
                    <span style="font-weight: 500">${title}</span>
                </div>
            `;
        } else {
            return `
                <div style="
                    position: relative;
                    padding: 0 8px;
                    width: auto;
                    height: ${height}px;
                    background-color: ${style.bgColor};
                    border: 2px solid ${style.color};
                    border-radius: 20px;
                    font-size: ${fontSize}px;
                    white-space: nowrap;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    transition: all 0.2s ease;
                "
                onmouseover="this.style.transform='scale(1.1)'; this.style.zIndex='1000';"
                onmouseout="this.style.transform='scale(1)'; this.style.zIndex='auto';"
                title="${title} (${style.category})">
                    <span style="margin-right: 6px">${style.emoji}</span><span>${title}</span>
                </div>
            `;
        }
    }

    // Îç∞Ïä§ÌÅ¨ÌÉë ÏÇ¨Ïù¥ÎìúÎ∞î ÌÜ†Í∏Ä
    function toggleSidebar() {
        if (isMobile()) return;

        sidebarOpen = !sidebarOpen;
        const sidebar = document.getElementById("sidebar");
        const mapContainer = document.getElementById("mapContainer");
        const listToggle = document.getElementById("listToggle");

        if (sidebarOpen) {
            sidebar.classList.add("open");
            mapContainer.classList.add("sidebar-open");
            listToggle.classList.add("active");
        } else {
            sidebar.classList.remove("open");
            mapContainer.classList.remove("sidebar-open");
            listToggle.classList.remove("active");

            if (detailPanelOpen) {
                closeDetailPanel();
            }
        }
    }

    // Î™®Î∞îÏùº Ìå®ÎÑê ÌÜ†Í∏Ä
    function togglePanel() {
        if (!isMobile()) return;

        panelExpanded = !panelExpanded;
        const panel = document.getElementById('bottomPanel');

        if (panelExpanded) {
            panel.classList.remove('collapsed');
        } else {
            panel.classList.add('collapsed');
        }
    }

    // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ (Î™®Î∞îÏùº Ï†ÑÏö©)
    function setupPanelTouchEvents() {
        if (!isMobile()) return;

        const panelHeader = document.getElementById('panelHeader');
        const panel = document.getElementById('bottomPanel');

        if (!panelHeader || !panel) return;

        // ÌÑ∞Ïπò ÏãúÏûë
        panelHeader.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
            isDragging = true;
        }, { passive: true });

        // ÌÑ∞Ïπò Ïù¥Îèô
        panelHeader.addEventListener('touchmove', function(e) {
            if (!isDragging) return;
            currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;

            // ÎìúÎûòÍ∑∏ Î∞©Ìñ•Ïóê Îî∞Îùº Ìå®ÎÑê ÏÉÅÌÉú Î≥ÄÍ≤Ω
            if (deltaY > 50 && panelExpanded) {
                togglePanel();
                isDragging = false;
            } else if (deltaY < -50 && !panelExpanded) {
                togglePanel();
                isDragging = false;
            }
        }, { passive: true });

        // ÌÑ∞Ïπò Ï¢ÖÎ£å
        panelHeader.addEventListener('touchend', function(e) {
            isDragging = false;
        });

        // ÌÅ¥Î¶≠ÏúºÎ°úÎèÑ ÌÜ†Í∏Ä Í∞ÄÎä•
        panelHeader.addEventListener('click', togglePanel);
    }

    // Í±∞Î¶¨ Ï∂îÍ∞Ä
    function addDistancesToPlaces() {
        if (!userLocation) return;
        allPlaces.forEach(place => {
            const distance = calculateDistance(
                userLocation.lat(),
                userLocation.lng(),
                parseFloat(place.mapy),
                parseFloat(place.mapx)
            );
            place.distance = distance;
        });
    }

    // Ï†ïÎ†¨
    function sortPlaces(places, sortBy) {
        const sorted = [...places];
        if (sortBy === 'distance') {
            sorted.sort((a, b) => (a.distance || 0) - (b.distance || 0));
        } else if (sortBy === 'name') {
            sorted.sort((a, b) => a.title.localeCompare(b.title));
        }
        return sorted;
    }

    // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏÉùÏÑ±
    function createCategoryFilters() {
        const categorySet = new Set();
        allPlaces.forEach(place => {
            const style = getCategoryStyle(place.contenttypeid);
            categorySet.add(JSON.stringify({
                id: place.contenttypeid,
                name: style.category,
                color: style.color,
                emoji: style.emoji
            }));
        });

        // Îç∞Ïä§ÌÅ¨ÌÉëÍ≥º Î™®Î∞îÏùº Í∞ÅÍ∞Å Ï≤òÎ¶¨
        const desktopFilters = document.getElementById('desktopCategoryFilters');
        const mobileFilters = document.getElementById('mobileCategoryFilters');

        [
            { container: desktopFilters, isMobile: false },
            { container: mobileFilters, isMobile: true }
        ].forEach(({ container, isMobile }) => {
            if (!container) return;

            const allFilters = container.querySelector("[data-category='all']");

            Array.from(categorySet).forEach(categoryStr => {
                const category = JSON.parse(categoryStr);
                const filterElement = document.createElement("div");
                filterElement.className = "category-filter";
                filterElement.dataset.category = category.id;

                if (isMobile) {
                    filterElement.innerHTML = `${category.emoji} ${category.name}`;
                } else {
                    filterElement.textContent = category.name;
                }

                filterElement.addEventListener("click", () => filterByCategory(category.id));
                container.appendChild(filterElement);
            });

            if (allFilters) {
                allFilters.addEventListener('click', function () {
                    filterByCategory('all');
                });
            }
        });
    }

    // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïÑÌÑ∞ÎßÅ
    function filterByCategory(categoryId) {
        currentCategory = categoryId;
        document.querySelectorAll('.category-filter').forEach(filter => {
            filter.classList.remove("active");
        });
        document.querySelectorAll(`[data-category='${categoryId}']`).forEach(filter => {
            filter.classList.add("active");
        });

        if (categoryId === 'all') {
            filteredPlaces = [...allPlaces];
        } else {
            filteredPlaces = allPlaces.filter(place => place.contenttypeid === categoryId);
        }

        updatePlacesList();
        updateMapMarkers();
    }

    // Ï†ïÎ†¨ Î≥ÄÍ≤Ω
    function changeSortOrder(sortBy) {
        currentSort = sortBy;
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelectorAll(`[data-sort='${sortBy}']`).forEach(btn => {
            btn.classList.add('active');
        });
        updatePlacesList();
    }

    // Ïû•ÏÜå Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
    function updatePlacesList() {
        const desktopList = document.getElementById('desktopPlacesList');
        const mobileList = document.getElementById('mobilePlacesList');
        const desktopCount = document.getElementById('desktopPlaceCount');
        const mobileCount = document.getElementById('mobilePlaceCount');

        const sortedPlaces = sortPlaces(filteredPlaces, currentSort);

        [desktopCount, mobileCount].forEach(countEl => {
            if (countEl) countEl.textContent = sortedPlaces.length;
        });

        [
            { list: desktopList, isMobile: false },
            { list: mobileList, isMobile: true }
        ].forEach(({ list, isMobile }) => {
            if (!list) return;

            list.innerHTML = '';

            sortedPlaces.forEach((place, index) => {
                const style = getCategoryStyle(place.contenttypeid);
                const placeItem = document.createElement('div');
                placeItem.className = 'place-item';
                placeItem.dataset.placeId = place.contentid;
                placeItem.dataset.id = place.id;
                placeItem.addEventListener('click', () => openDetailPanel(place));

                const distanceHtml = place.distance !== undefined ?
                    `<div class="place-distance">${formatDistance(place.distance)}</div>` : '';

                const categoryBadgeText = isMobile ? `${style.emoji} ${style.category}` : style.category;

                placeItem.innerHTML = `
                    <div class="place-header">
                        <h3 class="place-title">${place.title}</h3>
                        <span class="category-badge" style="background-color: ${style.bgColor}; color: ${style.color}; border: 1px solid ${style.color};">
                            ${categoryBadgeText}
                        </span>
                    </div>
                    <p class="place-address">${place.addr1 || 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                    ${distanceHtml}
                    <div class="place-actions">
                        <button class="action-btn" onclick="event.stopPropagation(); focusOnPlace('${place.mapy}', '${place.mapx}')">ÏßÄÎèÑÏóêÏÑú Î≥¥Í∏∞</button>
                    </div>
                `;

                list.appendChild(placeItem);
            });
        });
    }

    // ÏßÄÎèÑÏóêÏÑú Ïû•ÏÜå Ìè¨Ïª§Ïä§
    function focusOnPlace(lat, lng) {
        const position = new naver.maps.LatLng(lat, lng);
        map.setCenter(position);
        map.setZoom(isMobile() ? 18 : 17);

        // Î™®Î∞îÏùºÏóêÏÑú Ìå®ÎÑê Ï†ëÍ∏∞
        if (isMobile() && panelExpanded) {
            togglePanel();
        }
    }

    // ÏßÄÎèÑ ÎßàÏª§ ÏóÖÎç∞Ïù¥Ìä∏
    function updateMapMarkers() {
        if (markerClustering) {
            markerClustering.setMap(null);
        }

        markers.forEach(marker => {
            marker.setMap(null);
        });
        markers = [];

        filteredPlaces.forEach(place => {
            const markerSize = isMobile() ? 45 : 40;
            let marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(place.mapy, place.mapx),
                title: place.title,
                icon: {
                    content: createMarkerHtml(place.title, place.contenttypeid),
                    size: new naver.maps.Size(markerSize, markerSize),
                    anchor: new naver.maps.Point(markerSize/2, markerSize/2)
                }
            });

            naver.maps.Event.addListener(marker, 'click', () => {
                openDetailPanel(place);
            });

            markers.push(marker);
        });

        // ÌÅ¥Îü¨Ïä§ÌÑ∞ÎßÅ Ï†ÅÏö©
        if (typeof MarkerClustering !== 'undefined') {
            const clusterSize = isMobile() ? 50 : 40;
            markerClustering = new MarkerClustering({
                minClusterSize: 2,
                maxZoom: isMobile() ? 17 : 18,
                map: map,
                markers: markers,
                disableClickZoom: false,
                gridSize: isMobile() ? 150 : 120,
                icons: [
                    {
                        content: `<div style="cursor:pointer;width:${clusterSize}px;height:${clusterSize}px;line-height:${clusterSize+2}px;font-size:${isMobile() ? 12 : 10}px;color:white;text-align:center;font-weight:bold;background:#007bff;border-radius:${clusterSize/2}px;border:3px solid white;box-shadow:0 3px 12px rgba(0,0,0,0.2);"></div>`,
                        size: new naver.maps.Size(clusterSize, clusterSize),
                        anchor: new naver.maps.Point(clusterSize/2, clusterSize/2)
                    }
                ],
                indexGenerator: [10, 100, 200, 500, 1000],
                stylingFunction: function(clusterMarker, count) {
                    clusterMarker.getElement().querySelector('div').innerText = count;
                }
            });
        } else {
            markers.forEach(marker => {
                marker.setMap(map);
            });
        }
    }

    // ÏÉÅÏÑ∏ Ìå®ÎÑê Í¥ÄÎ†® Î≥ÄÏàòÎì§
    let currentSlideIndex = 0;
    let totalSlides = 0;

    // ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
    function updateDetailPanel(place) {
        const style = getCategoryStyle(place.contenttypeid);

        document.getElementById('detailTitle').textContent = place.title;

        const categoryText = isMobile() ? `${style.emoji} ${style.category}` : style.category;
        document.getElementById('detailCategory').textContent = categoryText;

        const distanceElement = document.getElementById('detailDistance');
        if (place.distance !== undefined) {
            distanceElement.innerHTML = `ÌòÑÏû¨ÏúÑÏπòÏóêÏÑú ${formatDistance(place.distance)}`;
            distanceElement.style.display = 'block';
        } else {
            distanceElement.style.display = 'none';
        }

        const basicInfoElement = document.getElementById('detailBasicInfo');
        const categoryValue = isMobile() ? `${style.emoji} ${style.category}` : style.category;

        basicInfoElement.innerHTML = `
            <div class="detail-info-item">
                <span class="detail-info-label">Ï£ºÏÜå</span>
                <span class="detail-info-value">${place.addr1 || 'Ï†ïÎ≥¥ ÏóÜÏùå'}</span>
            </div>
            <div class="detail-info-item">
                <span class="detail-info-label">Ï†ÑÌôîÎ≤àÌò∏</span>
                <span class="detail-info-value">${place.tel || 'Ï†ïÎ≥¥ ÏóÜÏùå'}</span>
            </div>
            <div class="detail-info-item">
                <span class="detail-info-label">Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                <span class="detail-info-value">${categoryValue}</span>
            </div>
        `;
    }

    // ÏÉÅÏÑ∏ Ìå®ÎÑê Ïó¥Í∏∞
    function openDetailPanel(place) {
        selectedPlace = place;
        detailPanelOpen = true;

        const detailPanel = document.getElementById('detailPanel');
        detailPanel.classList.add('open');

        if (!isMobile()) {
            if (!sidebarOpen) {
                toggleSidebar();
            }
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.classList.add('detail-open');
        } else {
            // Î™®Î∞îÏùºÏóêÏÑúÎäî Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ
            document.body.style.overflow = 'hidden';
        }

        updateDetailPanel(place);
        updateImageBox(place);
        highlightSelectedPlace(place.contentid);
        getMapDetail(place.id);
        loadReviews();
    }

    // ÏÉÅÏÑ∏ Ìå®ÎÑê Îã´Í∏∞ Ìï®Ïàò
    function closeDetailPanel() {
        detailPanelOpen = false;
        selectedPlace = null;

        const detailPanel = document.getElementById('detailPanel');
        detailPanel.classList.remove('open');

        if (!isMobile()) {
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.classList.remove('detail-open');
        } else {
            // Ïä§ÌÅ¨Î°§ Î≥µÏõê
            document.body.style.overflow = '';
        }

        removeAllHighlights();
    }

    // Ïù¥ÎØ∏ÏßÄ Ïä¨ÎùºÏù¥Îçî ÏóÖÎç∞Ïù¥Ìä∏
    function updateImageBox(place) {
        const sliderWrapper = document.querySelector('.slider-wrapper');
        const imageCounter = document.querySelector('.image-counter');
        const navButtons = document.querySelectorAll('.slider-nav');

        if (!sliderWrapper) return;

        if (place.imageDTOList && place.imageDTOList.length > 0) {
            totalSlides = place.imageDTOList.length;
            currentSlideIndex = 0;

            let imagesHTML = '';
            place.imageDTOList.forEach((image, index) => {
                imagesHTML += `
                    <div class="image-box">
                        <img src="${image.imageURL}" alt="Ïû•ÏÜå Ïù¥ÎØ∏ÏßÄ ${index + 1}" loading="lazy">
                    </div>
                `;
            });

            sliderWrapper.innerHTML = imagesHTML;
            navButtons.forEach(btn => {
                btn.style.display = totalSlides > 1 ? 'flex' : 'none';
            });

            if (imageCounter) {
                const currentIndexSpan = imageCounter.querySelector('.currentImageIndex');
                const totalSpan = imageCounter.querySelector('span:last-child');
                if (currentIndexSpan) currentIndexSpan.textContent = '1';
                if (totalSpan) totalSpan.textContent = totalSlides.toString();
                imageCounter.style.display = totalSlides > 1 ? 'block' : 'none';
            }

            updateDots();
        } else {
            sliderWrapper.innerHTML = `
                <div class="image-box">
                    <div style="color: #999; font-size: 16px;">Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
                </div>
            `;
            navButtons.forEach(btn => btn.style.display = 'none');
            if (imageCounter) imageCounter.style.display = 'none';
            totalSlides = 0;
            currentSlideIndex = 0;
        }
    }

    // Ïä¨ÎùºÏù¥Îçî Í¥ÄÎ†® Ìï®ÏàòÎì§
    function updateDots() {
        const dotsContainer = document.querySelector('.slider-dots');
        if (!dotsContainer) return;

        dotsContainer.innerHTML = '';
        for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('div');
            dot.className = i === currentSlideIndex ? 'dot active' : 'dot';
            dot.onclick = () => goToSlide(i);
            dotsContainer.appendChild(dot);
        }
        dotsContainer.style.display = totalSlides > 1 ? 'flex' : 'none';
    }

    function prevSlide() {
        if (totalSlides <= 1) return;
        currentSlideIndex = currentSlideIndex > 0 ? currentSlideIndex - 1 : totalSlides - 1;
        updateSlider();
    }

    function nextSlide() {
        if (totalSlides <= 1) return;
        currentSlideIndex = currentSlideIndex < totalSlides - 1 ? currentSlideIndex + 1 : 0;
        updateSlider();
    }

    function goToSlide(index) {
        if (index < 0 || index >= totalSlides) return;
        currentSlideIndex = index;
        updateSlider();
    }

    function updateSlider() {
        const sliderWrapper = document.querySelector('.slider-wrapper');
        const imageCounter = document.querySelector('.image-counter .currentImageIndex');
        const dots = document.querySelectorAll('.dot');

        if (sliderWrapper) {
            const translateX = -currentSlideIndex * 100;
            sliderWrapper.style.transform = `translateX(${translateX}%)`;
        }

        if (imageCounter) {
            imageCounter.textContent = (currentSlideIndex + 1).toString();
        }

        dots.forEach((dot, index) => {
            if (index === currentSlideIndex) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }

    // ÏÑ†ÌÉùÎêú Ïû•ÏÜå ÌïòÏù¥ÎùºÏù¥Ìä∏
    function highlightSelectedPlace(contentId) {
        removeAllHighlights();
        const placeItems = document.querySelectorAll(`[data-place-id="${contentId}"]`);
        placeItems.forEach(item => {
            item.classList.add('selected');
        });
    }

    function removeAllHighlights() {
        document.querySelectorAll('.place-item.selected').forEach(item => {
            item.classList.remove('selected');
        });
    }

    // ÌòÑÏû¨ ÏúÑÏπòÎ°ú Ïù¥Îèô
    function moveToCurrentLocation() {
        if (!navigator.geolocation) {
            alert('ÏúÑÏπò Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
            return;
        }

        if (isMobile()) {
            // ÌïòÎã® Ìå®ÎÑê Ï†ëÍ∏∞
            const bottomPanel = document.getElementById('bottomPanel');
            if (bottomPanel) {
                bottomPanel.classList.add('collapsed');
                panelExpanded = false;
            }
        }

        navigator.geolocation.getCurrentPosition(function (position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const newLocation = new naver.maps.LatLng(lat, lng);

            map.setCenter(newLocation);
            map.setZoom(isMobile() ? 16 : 15);
            userLocation = newLocation;
            addDistancesToPlaces();

            if (currentSort === 'distance') {
                updatePlacesList();
            }
        });
    }

    // API Ìò∏Ï∂ú Ìï®ÏàòÎì§
    async function getMapDetail(id) {
        if (!id) return;
        try {
            const response = await fetch(`/api/map/detail/${id}`);
            const data = await response.json();
            if (data.imageDTOList && data.imageDTOList.length > 0) {
                updateImageBox(data);
            }
        } catch (error) {
            console.log('ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', error);
        }
    }

    async function getMap() {
        try {
            const response = await fetch("/api/map");
            const data = await response.json();

            allPlaces = data;
            filteredPlaces = [...data];

            addDistancesToPlaces();
            createCategoryFilters();
            updatePlacesList();
            updateMapMarkers();
        } catch (error) {
            console.log(error);
        }
    }

    // DOM Ï§ÄÎπÑ ÏôÑÎ£å ÌõÑ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Î°úÎìú ÏôÑÎ£å');

        // Î™®Î∞îÏùºÏóêÏÑúÎßå Ìå®ÎÑê ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        if (isMobile()) {
            setupPanelTouchEvents();
        }

        // Îç∞Ïä§ÌÅ¨ÌÉë Ï†ÑÏö© Ïù¥Î≤§Ìä∏
        const listToggle = document.getElementById('listToggle');
        const closeSidebar = document.getElementById('closeSidebar');
        const closeDetailPanelBtn = document.getElementById('closeDetailPanel');

        if (listToggle) {
            listToggle.addEventListener('click', toggleSidebar);
            console.log('Î¶¨Ïä§Ìä∏ ÌÜ†Í∏Ä Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞Îê®');
        }
        if (closeSidebar) {
            closeSidebar.addEventListener('click', toggleSidebar);
            console.log('ÏÇ¨Ïù¥ÎìúÎ∞î Îã´Í∏∞ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞Îê®');
        }
        if (closeDetailPanelBtn) {
            closeDetailPanelBtn.addEventListener('click', function() {
                console.log('Îç∞Ïä§ÌÅ¨ÌÉë ÏÉÅÏÑ∏Ìå®ÎÑê Îã´Í∏∞ ÌÅ¥Î¶≠Îê®');
                closeDetailPanel();
            });
            console.log('Îç∞Ïä§ÌÅ¨ÌÉë ÏÉÅÏÑ∏Ìå®ÎÑê Îã´Í∏∞ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞Îê®');
        }

        // Î™®Î∞îÏùº Ï†ÑÏö© Ïù¥Î≤§Ìä∏
        const detailBackBtn = document.getElementById('detailBackBtn');
        if (detailBackBtn) {
            detailBackBtn.addEventListener('click', function() {
                console.log('Î™®Î∞îÏùº Îí§Î°úÍ∞ÄÍ∏∞ ÌÅ¥Î¶≠Îê®');
                closeDetailPanel();
            });
            console.log('Î™®Î∞îÏùº Îí§Î°úÍ∞ÄÍ∏∞ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞Îê®');
        }

        // Í≥µÌÜµ Ïù¥Î≤§Ìä∏
        const focusOnMapBtn = document.getElementById('focusOnMapBtn');
        const getDirectionsBtn = document.getElementById('getDirectionsBtn');
        const locationBtn = document.getElementById('locationBtn');

        if (focusOnMapBtn) {
            focusOnMapBtn.addEventListener('click', () => {
                if (selectedPlace) {
                    focusOnPlace(selectedPlace.mapy, selectedPlace.mapx);
                    if (isMobile()) {
                        closeDetailPanel();
                    }
                }
            });
        }

        if (getDirectionsBtn) {
            getDirectionsBtn.addEventListener('click', () => {
                if (selectedPlace) {
                    const url = `https://map.naver.com/v5/directions/?c=15,0,0,0,dh&sp=&ep=${selectedPlace.mapx},${selectedPlace.mapy}&ewp=place`;
                    window.open(url, '_blank');
                }
            });
        }

        // ÌòÑÏû¨ÏúÑÏπò Î≤ÑÌäº
        if (locationBtn) {
            locationBtn.addEventListener('click', function () {
                moveToCurrentLocation();

                const sidebar = document.getElementById('sidebar');
                if (sidebar && sidebar.classList.contains('open')) {
                    toggleSidebar();
                }
            });
        }

        // Ï†ïÎ†¨ Î≤ÑÌäºÎì§
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sortBy = this.dataset.sort;
                changeSortOrder(sortBy);
            });
        });

        // Î¶¨Î∑∞ ÏûÖÎ†• Í∏ÄÏûêÏàò Ïπ¥Ïö¥ÌÑ∞
        const reviewContent = document.getElementById('reviewContent');
        const contentCount = document.getElementById('contentCount');

        if (reviewContent && contentCount) {
            reviewContent.addEventListener('input', function() {
                contentCount.textContent = this.value.length;
            });
        }

        // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Í∞êÏßÄ
        window.addEventListener('resize', function() {
            // ÌïÑÏöîÏãú ÎßàÏª§ÎÇò UI ÏóÖÎç∞Ïù¥Ìä∏
            if (markers.length > 0) {
                updateMapMarkers();
            }
        });
    });

    // Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº Ï≤òÎ¶¨ (Î™®Î∞îÏùº)
    window.addEventListener('popstate', function(e) {
        if (isMobile() && detailPanelOpen) {
            e.preventDefault();
            closeDetailPanel();
            history.pushState(null, null, location.href);
        }
    });

    // Ï¥àÍ∏∞ history state ÏÑ§Ï†ï (Î™®Î∞îÏùº)
    if (isMobile()) {
        history.pushState(null, null, location.href);
    }
</script>
</body>
</html>